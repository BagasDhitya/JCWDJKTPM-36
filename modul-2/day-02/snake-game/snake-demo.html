<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Snake Game - Single File</title>
    <style>
        :root {
            --bg: #0f1722;
            --panel: #0b1220;
            --accent: #10b981;
            --danger: #ef4444;
            --muted: #94a3b8
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: Inter, ui-sans-serif, system-ui, Helvetica, Arial
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #071024 0%, #0b1724 100%);
            color: #e6eef8
        }

        .wrap {
            width: min(720px, 92vw);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(2, 6, 23, 0.7)
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px
        }

        header h1 {
            font-size: 18px;
            margin: 0
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center
        }

        button {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: inherit;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer
        }

        button.primary {
            background: var(--accent);
            border-color: transparent;
            color: #04111a
        }

        .meta {
            display: flex;
            gap: 12px;
            align-items: center;
            font-size: 14px;
            color: var(--muted)
        }

        .game-area {
            display: flex;
            gap: 12px;
            align-items: flex-start
        }

        canvas {
            background: linear-gradient(180deg, #07203a, #041828);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            display: block
        }

        .side {
            min-width: 160px
        }

        .info {
            background: rgba(255, 255, 255, 0.02);
            padding: 12px;
            border-radius: 8px
        }

        .hint {
            font-size: 13px;
            color: var(--muted);
            margin-top: 8px
        }

        .big {
            font-size: 28px;
            font-weight: 700
        }

        .small {
            font-size: 13px;
            color: var(--muted)
        }

        .overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2, 6, 23, 0.6);
            visibility: hidden;
            opacity: 0;
            transition: all .15s
        }

        .overlay.show {
            visibility: visible;
            opacity: 1
        }

        .panel {
            background: var(--panel);
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(2, 6, 23, 0.8);
            text-align: center
        }

        .panel h2 {
            margin: 0 0 8px 0
        }

        .touch-controls {
            display: none;
            gap: 8px;
            margin-top: 10px
        }

        .dir-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.01)
        }

        @media (max-width:640px) {
            .game-area {
                flex-direction: column;
                align-items: center
            }

            .side {
                width: 100%
            }

            .touch-controls {
                display: flex;
                justify-content: center
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <h1>Snake — Single File</h1>
            <div class="controls">
                <div class="meta">Use Arrow keys / WASD • Space to pause</div>
                <button id="btnRestart" class="primary">Restart</button>
            </div>
        </header>

        <div class="game-area">
            <canvas id="game" width="480" height="480"></canvas>

            <div class="side">
                <div class="info">
                    <div>Score</div>
                    <div id="score" class="big">0</div>
                    <div class="hint">Speed increases every 5 points</div>
                </div>

                <div class="info" style="margin-top:12px">
                    <div class="small">Rules</div>
                    <ul class="small">
                        <li>Eat food to grow</li>
                        <li>If head touches any body segment (including tail) → <strong style="color:var(--danger)">Game
                                Over</strong></li>
                        <li>Don't reverse direction directly</li>
                    </ul>
                </div>

                <div class="touch-controls" id="touch">
                    <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
                        <button class="dir-btn" data-dir="up">▲</button>
                        <div style="display:flex;gap:8px"><button class="dir-btn" data-dir="left">◀</button><button
                                class="dir-btn" data-dir="right">▶</button></div>
                        <button class="dir-btn" data-dir="down">▼</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" class="overlay">
        <div class="panel">
            <h2 id="ovTitle">Game Over</h2>
            <p id="ovText">You hit yourself.</p>
            <p style="margin-top:6px">Score: <strong id="ovScore">0</strong></p>
            <div style="margin-top:10px"><button id="ovRestart" class="primary">Play again</button></div>
        </div>
    </div>

    <script>
        (function () {
            const canvas = document.getElementById('game');
            const ctx = canvas.getContext('2d');
            const scoreEl = document.getElementById('score');
            const overlay = document.getElementById('overlay');
            const ovScore = document.getElementById('ovScore');
            const btnRestart = document.getElementById('btnRestart');
            const ovRestart = document.getElementById('ovRestart');
            const touch = document.getElementById('touch');

            const gridSize = 20; // number of cells per row/col
            const cell = canvas.width / gridSize; // pixel size of cell

            let snake = [{ x: 9, y: 9 }];
            let dir = { x: 0, y: 0 };
            let nextDir = { x: 0, y: 0 };
            let food = null;
            let score = 0;
            let speed = 6; // ticks per second
            let tickInterval = null;
            let running = false;

            function randPos() {
                return { x: Math.floor(Math.random() * gridSize), y: Math.floor(Math.random() * gridSize) };
            }

            function placeFood() {
                let p;
                do {
                    p = randPos();
                } while (snake.some(s => s.x === p.x && s.y === p.y));
                food = p;
            }

            function reset() {
                snake = [{ x: 9, y: 9 }, { x: 8, y: 9 }, { x: 7, y: 9 }];
                dir = { x: 1, y: 0 };
                nextDir = { x: 1, y: 0 };
                score = 0; speed = 6;
                placeFood();
                scoreEl.textContent = score;
                start();
            }

            function start() {
                if (tickInterval) clearInterval(tickInterval);
                tickInterval = setInterval(tick, 1000 / speed);
                running = true;
            }

            function stop(reason) {
                running = false;
                clearInterval(tickInterval);
                overlay.classList.add('show');
                ovScore.textContent = score;
                document.getElementById('ovText').textContent = reason || 'Game Over';
            }

            function tick() {
                // update direction (prevent reversing directly)
                if ((nextDir.x !== -dir.x || nextDir.y !== -dir.y) || (dir.x === 0 && dir.y === 0)) {
                    dir = nextDir;
                }

                if (dir.x === 0 && dir.y === 0) return; // not moving yet

                const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

                // wrap around edges
                if (head.x < 0) head.x = gridSize - 1;
                if (head.x >= gridSize) head.x = 0;
                if (head.y < 0) head.y = gridSize - 1;
                if (head.y >= gridSize) head.y = 0;

                // check collision with body (including tail) => Game Over
                if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
                    stop('You ate your tail!');
                    return;
                }

                // move snake
                snake.unshift(head);

                // eat food?
                if (food && head.x === food.x && head.y === food.y) {
                    score += 1;
                    scoreEl.textContent = score;
                    // increase speed every 5 points
                    if (score % 5 === 0) {
                        speed = Math.min(18, speed + 1);
                        clearInterval(tickInterval);
                        tickInterval = setInterval(tick, 1000 / speed);
                    }
                    placeFood();
                } else {
                    snake.pop();
                }

                draw();
            }

            function draw() {
                // background
                ctx.fillStyle = '#04182a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // grid (subtle)
                ctx.strokeStyle = 'rgba(255,255,255,0.02)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= gridSize; i++) {
                    ctx.beginPath(); ctx.moveTo(i * cell, 0); ctx.lineTo(i * cell, canvas.height); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(0, i * cell); ctx.lineTo(canvas.width, i * cell); ctx.stroke();
                }

                // food
                if (food) {
                    ctx.fillStyle = '#ef4444';
                    roundRect(ctx, food.x * cell + 3, food.y * cell + 3, cell - 6, cell - 6, 6);
                    ctx.fill();
                }

                // snake
                for (let i = 0; i < snake.length; i++) {
                    const s = snake[i];
                    if (i === 0) {
                        // head
                        const grad = ctx.createLinearGradient(s.x * cell, s.y * cell, (s.x + 1) * cell, (s.y + 1) * cell);
                        grad.addColorStop(0, '#10b981'); grad.addColorStop(1, '#065f46');
                        ctx.fillStyle = grad;
                    } else {
                        ctx.fillStyle = 'rgba(255,255,255,0.06)';
                    }
                    roundRect(ctx, s.x * cell + 2, s.y * cell + 2, cell - 4, cell - 4, 6);
                    ctx.fill();
                }
            }

            function roundRect(ctx, x, y, w, h, r) {
                ctx.beginPath();
                ctx.moveTo(x + r, y);
                ctx.arcTo(x + w, y, x + w, y + h, r);
                ctx.arcTo(x + w, y + h, x, y + h, r);
                ctx.arcTo(x, y + h, x, y, r);
                ctx.arcTo(x, y, x + w, y, r);
                ctx.closePath();
            }

            // input
            window.addEventListener('keydown', function (e) {
                const key = e.key;
                if (key === 'ArrowUp' || key === 'w' || key === 'W') nextDir = { x: 0, y: -1 };
                if (key === 'ArrowDown' || key === 's' || key === 'S') nextDir = { x: 0, y: 1 };
                if (key === 'ArrowLeft' || key === 'a' || key === 'A') nextDir = { x: -1, y: 0 };
                if (key === 'ArrowRight' || key === 'd' || key === 'D') nextDir = { x: 1, y: 0 };
                if (key === ' ') { // space => pause
                    if (running) { clearInterval(tickInterval); running = false; } else start();
                }
            });

            // touch controls
            document.querySelectorAll('.dir-btn').forEach(btn => {
                btn.addEventListener('touchstart', (ev) => {
                    const d = btn.dataset.dir;
                    if (d === 'up') nextDir = { x: 0, y: -1 };
                    if (d === 'down') nextDir = { x: 0, y: 1 };
                    if (d === 'left') nextDir = { x: -1, y: 0 };
                    if (d === 'right') nextDir = { x: 1, y: 0 };
                    ev.preventDefault();
                });
            });

            // restart buttons
            btnRestart.addEventListener('click', () => { overlay.classList.remove('show'); reset(); });
            ovRestart.addEventListener('click', () => { overlay.classList.remove('show'); reset(); });

            // init
            placeFood();
            draw();

            // small autoplay to start moving
            setTimeout(() => {
                nextDir = { x: 1, y: 0 };
                start();
            }, 300);

            // responsive: scale canvas CSS to fit while keeping crisp pixels
            function fitCanvas() {
                const containerWidth = Math.min(480, document.querySelector('.wrap').clientWidth - 200);
                if (window.innerWidth < 640) canvas.style.width = Math.min(360, window.innerWidth - 40) + 'px';
                else canvas.style.width = '480px';
            }
            window.addEventListener('resize', fitCanvas);
            fitCanvas();

        })();
    </script>
</body>

</html>